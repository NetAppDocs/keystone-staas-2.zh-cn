---
sidebar: sidebar 
permalink: installation/configuration.html 
keywords: configuration keystone collector 
summary: 完成配置以使Keystone Collector 能够收集存储环境中的使用数据。 
---
= 配置Keystone收集器
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
您需要完成一些配置任务才能使Keystone Collector 能够收集存储环境中的使用数据。这是一次性活动，用于激活所需组件并将其与您的存储环境关联起来。

[NOTE]
====
* Keystone Collector 为您提供了Keystone Collector 管理终端用户界面 (TUI) 实用程序来执行配置和监控活动。您可以使用各种键盘控制（例如 Enter 和箭头键）来选择选项并浏览此 TUI。
* Keystone Collector 可以为无法访问互联网的组织进行配置，也称为_暗站_或_私人模式_。要了解更多信息，请参阅link:../dark-sites/overview.html["Keystone处于私人模式"]。


====
.步骤
. 启动Keystone Collector 管理 TUI 实用程序：
`$ keystone-collector-tui`
. 转到**配置> KS-Collector**打开Keystone Collector 配置屏幕，查看可用的更新选项。
. 更新所需的选项。
+
.<strong>适用于ONTAP</strong>
[%collapsible]
====
** *收集ONTAP使用情况*：此选项可收集ONTAP的使用情况数据。添加Active IQ Unified Manager （Unified Manager）服务器和服务帐户的详细信息。
** *收集ONTAP性能数据*：此选项可收集ONTAP的性能数据。默认情况下，此功能是禁用的。如果您的环境需要出于 SLA 目的进行性能监控，请启用此选项。提供 Unified Manager 数据库用户帐户详细信息。有关创建数据库用户的信息，请参阅link:../installation/addl-req.html["创建 Unified Manager 用户"]。
** *删除私人数据*：此选项删除客户的特定私人数据，默认启用。有关启用此选项后哪些数据将从指标中排除的信息，请参阅link:../installation/configuration.html#limit-collection-of-private-data["限制收集私人数据"]。


====
+
.对于StorageGRID
[%collapsible]
====
** *收集StorageGRID使用情况*：此选项可以收集节点使用情况的详细信息。添加StorageGRID节点地址和用户详细信息。
** *删除私人数据*：此选项删除客户的特定私人数据，默认启用。有关启用此选项后哪些数据将从指标中排除的信息，请参阅link:../installation/configuration.html#limit-collection-of-private-data["限制收集私人数据"]。


====
. 切换**使用系统启动 KS-Collector**字段。
. 单击**保存**。image:tui-1.png["tui屏幕"]
. 通过返回 TUI 主屏幕并验证**服务状态**信息，确保Keystone Collector 处于健康状态。系统应显示服务处于**总体：健康**状态。image:tui-2.png["tui屏幕"]
. 通过选择主屏幕上的“退出到 Shell”选项退出Keystone Collector 管理 TUI。




== 在Keystone Collector 上配置 HTTP 代理

收集器软件支持使用 HTTP 代理与互联网通信。这可以在 TUI 中进行配置。

.步骤
. 如果已关闭，请重新启动Keystone Collector 管理 TUI 实用程序：
`$ keystone-collector-tui`
. 切换到**HTTP 代理**字段，并添加 HTTP 代理服务器、端口和凭据的详细信息（如果需要身份验证）。
. 单击**保存**。image:tui-3.png["tui屏幕"]




== 限制收集私人数据

Keystone Collector 收集执行订阅计量所需的有限配置、状态和性能信息。有一个选项可以通过屏蔽上传内容中的敏感信息来进一步限制收集的信息。这不会影响账单计算。但是，限制信息可能会影响报告信息的可用性，因为一些用户可以轻松识别的元素（例如卷名）被 UUID 取代。

限制特定客户数据的收集是Keystone Collector TUI 屏幕上的可配置选项。此选项“*删除私人数据*”默认启用。

image:tui-4.png["tui屏幕"]

有关在ONTAP和StorageGRID中限制私有数据访问而删除的项目的信息，请参阅link:../installation/data-collection.html["限制私人数据访问而删除的项目列表"]。



== 信任自定义根 CA

根据公共根证书颁发机构 (CA) 验证证书是Keystone Collector 安全功能的一部分。但是，如果需要，您可以将Keystone Collector 配置为信任自定义根 CA。

如果您在系统防火墙中使用 SSL/TLS 检查，则会导致基于互联网的流量使用您的自定义 CA 证书重新加密。在接受根证书并允许连接之前，需要配置设置以验证源是否为受信任的 CA。按照下面的步骤进行操作：

.步骤
. 准备CA证书。它应该是_base64 编码的 X.509_ 文件格式。
+

NOTE: 支持的文件扩展名是 `.pem`， `.crt` ， `.cert` 。确保证书采用以下格式之一。

. 将证书复制到Keystone Collector 服务器。记下文件复制的位置。
. 在服务器上打开终端并运行管理 TUI 实用程序。
`$ keystone-collector-tui`
. 转到*配置>高级*。
. 启用选项*启用自定义根证书*。
. 对于 *选择自定义根证书路径：*，选择 `- Unset -`
. 按 Enter。弹出选择证书路径的对话框。
. 从文件系统浏览器中选择根证书或输入精确的路径。
. 按 Enter。您将返回到*高级*屏幕。
. 选择*保存*。配置已应用。



NOTE: CA证书被复制到 `/opt/netapp/ks-collector/ca.pem` 在Keystone Collector 服务器上。

image:kc-custom-ca.png["用于 CA 定制的 TUI 屏幕"]



== 创建性能服务级别

您可以使用Keystone Collector 管理 TUI 实用程序创建性能服务级别 (PSL)。通过 TUI 创建 PSL 会自动选择为每个性能服务级别设置的默认值，从而减少通过Active IQ Unified Manager创建 PSL 时手动设置这些值时可能发生的错误的可能性。

要了解有关 PSL 的更多信息，请参阅link:https://docs.netapp.com/us-en/active-iq-unified-manager/storage-mgmt/concept_manage_performance_service_levels.html["性能服务级别"^]。

要了解有关服务级别的更多信息，请参阅link:https://docs.netapp.com/us-en/keystone-staas/concepts/service-levels.html#service-levels-for-file-and-block-storage["Keystone的服务级别"^]。

.步骤
. 启动Keystone Collector 管理 TUI 实用程序：
`$ keystone-collector-tui`
. 转到*配置>AIQUM*以打开 AIQUM 屏幕。
. 启用选项*创建 AIQUM 性能配置文件*。
. 输入Active IQ Unified Manager服务器和用户帐户的详细信息。这些详细信息是创建 PSL 所必需的，并且不会被存储。
+
image:qos-account-details-1.png["TUI 屏幕用于输入 AIQUM 服务器和服务帐户的详细信息"]

. 对于“选择Keystone版本”，选择 `-unset-`。
. 按 Enter。弹出选择Keystone版本的对话框。
. 突出显示 *STaaS* 以指定Keystone STaaS 的Keystone版本，然后按 Enter。
+
image:qos-STaaS-selection-2.png["用于指定Keystone版本的 TUI 屏幕"]

+

NOTE: 您可以突出显示Keystone订阅服务版本 1 的 *KFS* 选项。Keystone订阅服务与Keystone STaaS 在组成性能服务级别、服务产品和计费原则方面有所不同。要了解更多信息，请参阅link:https://docs.netapp.com/us-en/keystone-staas/subscription-services-v1.html["Keystone订阅服务 | 版本 1"^]。

. 所有受支持的Keystone性能服务级别将显示在指定Keystone版本的 *选择Keystone服务级别* 选项中。从列表中启用所需的性能服务级别。
+
image:qos-STaaS-selection-3.png["TUI 屏幕显示所有支持的Keystone服务级别"]

+

NOTE: 您可以同时选择多个性能服务级别来创建 PSL。

. 选择“*保存*”并按 Enter。将创建性能服务级别。
+
您可以在Active IQ Unified Manager中的 *性能服务级别* 页面上查看已创建的 PSL，例如 STaaS 的 Premium-KS-STaaS 或 KFS 的 Extreme KFS。如果创建的 PSL 不能满足您的要求，那么您可以修改 PSL 以满足您的需求。要了解更多信息，请参阅link:https://docs.netapp.com/us-en/active-iq-unified-manager/storage-mgmt/task_create_and_edit_psls.html["创建和编辑性能服务级别"^]。

+
image:qos-performance-sl.png["显示已创建的 AQoS 策略的 UI 屏幕截图"]




TIP: 如果所选性能服务级别的 PSL 已存在于指定的Active IQ Unified Manger 服务器上，则无法再次创建它。如果您尝试这样做，您将收到一条错误消息。image:qos-failed-policy-1.png["TUI 屏幕显示策略创建错误消息"]
